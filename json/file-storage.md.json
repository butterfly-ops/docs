{
    "file_name": "file-storage.md",
    "sections": [
        {
            "header": "File Storage",
            "content": "\n<p>When dealing with scalable Cloud Systems, everyone needs different File Storages. butterfly provides an abstraction layer for you \nto upload your static images / files.</p>\n<p>Butterfly uses <a href=\"https://flysystem.thephpleague.com/v1/docs/\">Flysystem</a> for abstracting file systems. </p>\n"
        },
        {
            "header": "Storage Drivers",
            "content": "\n<p>You can use multiple storages at the same time. Storages are managed under <code>System Settings &gt; CMS - File Storages</code> page. You\ncan add / edit / remove storages.</p>\n<p>File Storage Drivers are:</p>\n<ul>\n<li>Local Folder</li>\n<li>Amazon S3</li>\n<li>Azure Blob Storage</li>\n<li>SFTP</li>\n<li>FTP</li>\n</ul>\n<h3>Local Folder</h3>\n<p>This adapter ships with Butterfly by default.</p>\n<h3>Amazon S3</h3>\n<p>Installation</p>\n<p><code>bash\ncomposer require league/flysystem-aws-s3-v3</code></p>\n<h3>Azure Blob Storage</h3>\n<p>Installation</p>\n<p><code>bash\ncomposer require league/flysystem-azure-blob-storage</code></p>\n<h3>SFTP</h3>\n<p>Installation</p>\n<p><code>bash\ncomposer require league/flysystem-sftp</code></p>\n<h3>FTP</h3>\n<p>This adapter ships with Butterfly by default.</p>\n"
        },
        {
            "header": "Images",
            "content": "\n<p>Allowed extensions for images: <code>jpg, jpeg, gif, svg, png</code></p>\n<h3>Downloading an Image</h3>\n<p>You can upload / crop an image from Admin Panel if it's defined as Widget Spec, Setting or Object Spec; but you may need to download \nan image programatically.</p>\n<p>When you need to download an image, you can use the following code example:</p>\n<p>```php\n$mImageHelper = new \\Butterfly\\Framework\\Helper\\Image();</p>\n<p>// Subfolder parameter is optional, it defaults to current year and month\n$mImageHelper-&gt;downloadImage('https://www.example.com/example.png', 'image_alias', 'sub_folder/');\n```</p>\n<p>You can define Image Aliases from <code>System Settings</code> &gt; <code>Image Uploads</code>.</p>\n<p>successful response:</p>\n<p><code>php\n[\n    'success' =&gt; true,\n    'full_path' =&gt; 'https://thebutterfly.io/static/2020-01/01/test.png',\n    'filename' =&gt; '2020-01/01/test.png'\n];</code></p>\n<p>failed response:</p>\n<p><code>php\n[\n    'success' =&gt; false,\n    'message' =&gt; 'Error message'\n];</code></p>\n<h3>Handling Image Uploads</h3>\n<p>If you need to upload an image programatically else than Admin Panel, you can do it easily using the following example:</p>\n<p>```php\n$mImageHelper = new \\Butterfly\\Framework\\Helper\\Image();</p>\n<p>// Subfolder parameter is optional, it defaults to current year and month\n$mImageHelper-&gt;processUpload('UPLOAD_KEY', 'image_alias', 'sub_folder/');\n```</p>\n<p>UPLOAD_KEY designates the key in $_FILES array which means the input name of the Upload. You can define Image Aliases from <code>System Settings</code> &gt; <code>Image Uploads</code>.</p>\n<p>successful response:</p>\n<p><code>php\n[\n    'success' =&gt; true,\n    'full_path' =&gt; 'https://thebutterfly.io/static/2020-01/01/test.png',\n    'filename' =&gt; '2020-01/01/test.png'\n];</code></p>\n<p>failed response:</p>\n<p><code>php\n[\n    'success' =&gt; false,\n    'message' =&gt; 'Error message'\n];</code></p>\n<h3>Uploading Images Via API</h3>\n<p>You can upload images using Butterfly REST Api.</p>\n<p>For <code>api/upload/image</code> endpoint, available options:</p>\n<ul>\n<li>alias: Butterfly image upload alias, default: content</li>\n<li>sub_folder: Image upload path, default: null </li>\n<li>files: Array of Images</li>\n</ul>\n<p>Sample request:\n<code>curl --location --request POST 'http://domain.tld/api/upload/image' \\\n--form 'files[0]=@\"/path/image1.png\"' \\\n--form 'files[1]=@\"/path/image2.png\"'</code></p>\n<blockquote>\n<p>Note: Response includes webp params only when it was enabled.</p>\n</blockquote>\n<p>Sample success response:\n<code>{\n    \"success\": true,\n    \"result\": [\n        {\n            \"full_path\": \"https://cdn.url/static/img/content/21-01/24/image1.png\",\n            \"webp\": \"https://cdn.url/static/img/content/21-01/24/image1.png.webp\",\n            \"filename\": \"image.png\"\n        },\n        {\n            \"full_path\": \"https://cdn.url/static/img/content/21-01/24/image2.png\",\n            \"webp\": \"https://cdn.url/static/img/content/21-01/24/image2.png.webp\",\n            \"filename\": \"image.png\"\n        }\n    ]\n}</code></p>\n<p>Sample error response:\n<code>{\n    \"success\": false,\n    \"errors\": [\n        {\n            \"message\": \"error message\",\n            \"filename\": \"image1.png\"\n        },\n        {\n            \"message\": \"error message\",\n            \"filename\": \"image2.png\"\n        }\n    ]\n}</code></p>\n<h3>Getting Full Path</h3>\n<p>When you use image uploads, only filenames are kept in the Database. Although full paths of the images for all possible sizes are \nsaved in Elastic Search Index (Data Pools), you may want to get data from Database.</p>\n<p>You can get the full path of an image alias like the following:</p>\n<ul>\n<li>Getting image full path by alias from PHP Code:</li>\n</ul>\n<p><code>php\n$mCmsImageUpload = new \\Butterfly\\Core\\Model\\CmsImageUpload();\n$mCmsImageUpload-&gt;getFullPathByAlias('original'); // `original` is the alias of image upload</code></p>\n<ul>\n<li>Getting image full path by alias from Twig Templates:</li>\n</ul>\n<p><code>twig\n{{ image_path('image_alias') }}</code></p>\n"
        },
        {
            "header": "Files",
            "content": "\n<p>Allowed file upload extensions are defined from Admin panel.</p>\n<p>Restricted File Types: <code>php, php5, sh</code></p>\n<h3>Downloading a File</h3>\n<p>You can upload / crop an image from Admin Panel if it's defined as Widget Spec, Setting or Object Spec; but you may need to download \nan image programatically.</p>\n<p>When you need to download an image, you can use the following code example:</p>\n<p>```php\n$mFileHelper = new \\Butterfly\\Framework\\Helper\\File();</p>\n<p>// Subfolder parameter is optional, it defaults to current year and month\n$mFileHelper-&gt;downloadFile('https://www.example.com/example.xlsx', 'file_alias', 'sub_folder/');\n```</p>\n<p>You can define Image Aliases from <code>System Settings</code> &gt; <code>Image Uploads</code>.</p>\n<p>successful response:</p>\n<p><code>php\n[\n    'success' =&gt; true,\n    'full_path' =&gt; 'https://thebutterfly.io/static/2020-01/01/test.xlsx',\n    'filename' =&gt; '2020-01/01/test.xlsx'\n];</code></p>\n<p>failed response:</p>\n<p><code>php\n[\n    'success' =&gt; false,\n    'message' =&gt; 'Error message'\n];</code></p>\n<h3>Handling File Uploads</h3>\n<p>If you need to upload an image programatically else than Admin Panel, you can do it easily using the following example:</p>\n<p>```php\n$mFileHelper = new \\Butterfly\\Framework\\Helper\\File();</p>\n<p>// Subfolder parameter is optional, it defaults to current year and month\n$mFileHelper-&gt;processUpload('UPLOAD_KEY', 'file_alias', 'sub_folder/');\n```</p>\n<p>UPLOAD_KEY designates the key in $_FILES array which means the input name of the Upload. You can define Image Aliases from <code>System Settings</code> &gt; <code>Image Uploads</code>.</p>\n<p>successful response:</p>\n<p><code>php\n[\n    'success' =&gt; true,\n    'full_path' =&gt; 'https://thebutterfly.io/static/2020-01/01/test.xlsx',\n    'filename' =&gt; '2020-01/01/test.xlsx'\n];</code></p>\n<p>failed response:</p>\n<p><code>php\n[\n    'success' =&gt; false,\n    'message' =&gt; 'Error message'\n];</code></p>\n<h3>Uploading Files Via API</h3>\n<p>You can upload files using Butterfly REST Api.</p>\n<p>For <code>api/upload/file</code> endpoint, available options:</p>\n<ul>\n<li>alias: Butterfly file upload alias, default: content</li>\n<li>sub_folder: File upload path, default: null </li>\n<li>files: Array of Files</li>\n</ul>\n<p>Sample request:\n<code>curl --location --request POST 'http://domain.tld/api/upload/file' \\\n--form 'files[0]=@\"/path/file.mp4\"' \\\n--form 'files[1]=@\"/path/file2.pdf\"'</code></p>\n<p>Sample success response:\n<code>{\n    \"success\": true,\n    \"result\": [\n        {\n            \"full_path\": \"https://cdn.url/static/file/content/21-01/24/file.mp4\",\n            \"filename\": \"file.mp4\"\n        },\n        {\n            \"full_path\": \"https://cdn.url/static/file/content/21-01/24/file2.pdf\",\n            \"filename\": \"file2.pdf\"\n        }\n    ]\n}</code></p>\n<p>Sample error response:\n<code>{\n    \"success\": false,\n    \"errors\": [\n        {\n            \"message\": \"error message\",\n            \"filename\": \"file.mp4\"\n        },\n        {\n            \"message\": \"error message\",\n            \"filename\": \"file2.pdf\"\n        }\n    ]\n}</code></p>\n<h3>Getting Full Path</h3>\n<p>When you use file uploads, only filenames are kept in the Database. Although full path of the file upload \nsaved in Elastic Search Index (Data Pools), you may want to get data from Database.</p>\n<p>You can get the full path of an file alias like the following:</p>\n<ul>\n<li>Getting file full path by alias from PHP Code:</li>\n</ul>\n<p><code>php\n$mCmsFileUpload = new \\Butterfly\\Core\\Model\\CmsFileUpload();\n$mCmsFileUpload-&gt;getFullPathByAlias('file_upload_alias'); // `original` is the alias of image upload</code></p>\n<ul>\n<li>Getting image full path by alias from Twig Templates:</li>\n</ul>\n<p><code>twig\n{{ file_path('file_alias') }}</code></p>\n<h3>Updating Sub Folder for Uploads</h3>\n<p>By default, <code>butterfly</code> creates subfolders in year-month/day format. Which means that, when you upload a file named <code>x.jpg</code>\nyour file will be uploaded to 21-05/01/x.jpg if date is 1th of May in 2021.</p>\n<p>You can change this behaviour by updating Sub Folder Format on File Storage Admin. If you leave this field empty, it will default to\ndefault behaviour.</p>\n<p>If you set <code>/</code> to this setting, it will upload file to the root.</p>\n<p>If you want to use different dates, you can use strftime function format. You can checkout <a href=\"this link\">https://www.php.net/strftime</a></p>\n<h3>File Overwrite Strategy</h3>\n<p>When you let users to upload files or images, files with same filename is always something you need to consider. You can set Overwrite Strategy\noption under <code>File Storages</code> for uploaded files with same name.</p>\n<h4>Append Time:</h4>\n<p>If you choose this option, unix time will be added to filename if there is already a file with same name.</p>\n<p>For example: Let's say that you uploaded a file named <code>test.png</code>. If you upload another file with the same name, it will be saved as \n<code>test-1624119416.png</code>.</p>\n<p>Advantages:\n- Existing files with the same name used by other records will not be affected.\n- Since the name of the file is changed, CDN Caches automatically becomes invalid for updated images.</p>\n<h4>Overwrite:</h4>\n<p>Simple: It will replace the old file if a file with same name is added.</p>\n<blockquote>\n<p>[!WARNING]\nDon't choose <code>overwrite</code> option if you really don't need it. It may lead data loss since old files with same name is \noverridden. And if you need this option just for some Upload Config, create additional File Storage for these Upload Configs.</p>\n</blockquote>\n<h3>Filename Sanitization for Uploads</h3>\n<p>When you upload a file or image to Butterfly, it's a good practice to replace white-spaces and special characters in the filename to \nprevent errors on browsers etc, but sometimes you may want to leave filename as-is.</p>\n<p>Sanitize Option is enabled by default in <code>File Storage</code> settings, but if you uncheck this box, then it will leave the filename and spaces \nas-is.</p>\n<p>Example:</p>\n<p>If you upload a file named <code>Test Filename ÇÖĞ.jpg</code></p>\n<p>Sanitized version will be\n<code>test-filename-cog.jpg</code></p>\n<p>Not Sanitized version\n<code>Test Filename ÇÖĞ.jpg</code></p>"
        }
    ]
}